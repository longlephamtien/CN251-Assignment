# Dockerfile for Client Containers (Scalability Testing)
FROM python:3.12-slim

ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1

# Install dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    procps \
    net-tools \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy requirements
COPY bklv-backend/requirements.txt ./backend-requirements.txt
COPY tests/requirements.txt ./test-requirements.txt

# Install Python packages
RUN pip install --no-cache-dir -r backend-requirements.txt
RUN pip install --no-cache-dir -r test-requirements.txt

# Copy backend code
COPY bklv-backend/ ./bklv-backend/

# Copy test utilities
COPY tests/test_suites/ ./test_suites/
COPY tests/scripts/ ./scripts/

# Create directories
RUN mkdir -p /app/files /app/tests/results /app/logs /app/repos

# Ports: 6000-7000 for client PeerServers
EXPOSE 6000-7000

# Default: keep container running
CMD ["tail", "-f", "/dev/null"]
